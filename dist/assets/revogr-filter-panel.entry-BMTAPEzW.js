import{r as u,c as h,l as g,J as m,h as r,K as v,T as b,H as p,f as y}from"./index-BjFWP_KI.js";/*!
 * Built by Revolist OU ❤️
 */(function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(i){let e=this;do{if(Element.prototype.matches.call(e,i))return e;e=e.parentElement||e.parentNode}while(e!==null&&e.nodeType===1);return null})})();const x='revogr-filter-panel{position:absolute;display:block;top:0;left:0;z-index:100;max-height:calc(100% - 80px);min-width:250px;overflow:auto;opacity:1;transform:none;background-color:var(--revo-grid-filter-panel-bg, #fff);border:1px solid var(--revo-grid-filter-panel-border, #cecece);transform-origin:62px 0px;box-shadow:0 5px 18px -2px var(--revo-grid-filter-panel-shadow, rgba(0, 0, 0, 0.15));padding:10px;border-radius:8px;min-width:220px;text-align:left}revogr-filter-panel .filter-holder>div{display:flex;flex-direction:column}revogr-filter-panel label{font-size:13px;display:block;padding:8px 0}revogr-filter-panel select{width:100%}revogr-filter-panel input[type=text]{border:0;min-height:34px;margin:5px 0;background:var(--revo-grid-filter-panel-input-bg, #f3f3f3);border-radius:5px;padding:0 10px;box-sizing:border-box;width:100%}revogr-filter-panel button{margin-top:10px;margin-right:5px}revogr-filter-panel .filter-actions{text-align:right;margin-right:-5px}.rgHeaderCell:hover .rv-filter{transition:opacity 267ms cubic-bezier(0.4, 0, 0.2, 1) 0ms, transform 178ms cubic-bezier(0.4, 0, 0.2, 1) 0ms}.rgHeaderCell:hover .rv-filter,.rgHeaderCell .rv-filter.active{opacity:1}.rgHeaderCell .rv-filter{height:24px;width:24px;background:none;border:0;opacity:0;visibility:visible;cursor:pointer;border-radius:4px}.rgHeaderCell .rv-filter.active{color:#10224a}.rgHeaderCell .rv-filter .filter-img{color:gray;width:11px}.select-css{display:block;font-family:sans-serif;line-height:1.3;padding:0.6em 1.4em 0.5em 0.8em;width:100%;max-width:100%;box-sizing:border-box;margin:0;border:1px solid var(--revo-grid-filter-panel-select-border, #d9d9d9);box-shadow:transparent;border-radius:0.5em;appearance:none;background-color:var(--revo-grid-filter-panel-input-bg, #f3f3f3);background-image:url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007CB2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");background-repeat:no-repeat, repeat;background-position:right 0.7em top 50%, 0 0;background-size:0.65em auto, 100%;}.select-css::-ms-expand{display:none}.select-css:hover{border-color:var(--revo-grid-filter-panel-select-border, #d9d9d9)}.select-css:focus{border-color:var(--revo-grid-filter-panel-select-border-hover, #d9d9d9);box-shadow:0 0 1px 3px rgba(59, 153, 252, 0.7);box-shadow:0 0 0 3px -moz-mac-focusring;outline:none}.select-css option{font-weight:normal}.select-css:disabled,.select-css[aria-disabled=true]{color:gray;background-image:url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22graytext%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E"), linear-gradient(to bottom, #ffffff 0%, #ffffff 100%)}.select-css:disabled:hover,.select-css[aria-disabled=true]{border-color:var(--revo-grid-filter-panel-select-border, #d9d9d9)}.multi-filter-list{margin-top:5px;margin-bottom:5px}.multi-filter-list div{white-space:nowrap}.multi-filter-list .multi-filter-list-action{display:flex;justify-content:space-between;align-items:center}.multi-filter-list .and-or-button{margin:0 0 0 10px;min-width:58px;cursor:pointer}.multi-filter-list .trash-button{margin:0 0 -2px 6px;cursor:pointer;width:22px;height:100%;font-size:16px}.multi-filter-list .trash-button .trash-img{width:1em}.add-filter-divider{display:block;margin:0 -10px 10px -10px;border-bottom:1px solid var(--revo-grid-filter-panel-divider, #d9d9d9);height:10px}.select-input{display:flex;justify-content:space-between;align-items:center}',d="none",I="multi-filter-list",F="multi-filter-list-action",f="add-filter",C=class{constructor(t){u(this,t),this.filterChange=h(this,"filterChange",7),this.resetChange=h(this,"resetChange",7),this.filterCaptionsInternal={title:"Filter by",ok:"Close",save:"Save",reset:"Reset",cancel:"Cancel",add:"Add condition",placeholder:"Enter value...",and:"and",or:"or"},this.isFilterIdSet=!1,this.filterId=0,this.currentFilterId=-1,this.currentFilterType=d,this.filterItems={},this.filterNames={},this.filterEntities={},this.disableDynamicFiltering=!1,this.closeOnOutsideClick=!0,this.debouncedApplyFilter=g(()=>{this.filterChange.emit(this.filterItems)},400)}onMouseDown(t){if(!this.changes)return;const i=t.composedPath(),e=document.getElementById(f);if(e instanceof HTMLSelectElement){if(i.includes(e))return;e.value=d}this.currentFilterType=d,this.changes&&(this.changes.type=d),this.currentFilterId=-1;const s=!i.includes(this.element);t.target instanceof HTMLElement&&s&&!m(t.target)&&this.closeOnOutsideClick&&(this.changes=void 0)}async show(t){this.changes=t,this.filterItems=(t==null?void 0:t.filterItems)||{},this.changes&&(this.changes.type=this.changes.type||d)}async getChanges(){return this.changes}componentWillRender(){if(!this.isFilterIdSet){this.isFilterIdSet=!0;const t=Object.keys(this.filterItems);for(const i of t)this.filterId+=this.filterItems[i].length}}getFilterItemsList(){var t,i;const e=(t=this.changes)===null||t===void 0?void 0:t.prop;if(typeof e>"u")return"";const s=(i=this.filterItems[e])!==null&&i!==void 0?i:[],n=Object.assign(this.filterCaptionsInternal,this.filterCaptions);return r("div",{key:this.filterId},s.map((o,a)=>{let l;if(!o.hidden)return a!==this.filterItems[e].length-1&&(l=r("div",{onClick:()=>this.toggleFilterAndOr(o.id)},r(v,{text:o.relation==="and"?n.and:n.or}))),r("div",{key:o.id,class:I},r("div",{class:{"select-input":!0}},r("select",{class:"select-css select-filter",onChange:c=>this.onFilterTypeChange(c,e,a)},this.renderSelectOptions(this.filterItems[e][a].type,!0)),r("div",{class:F},l),r("div",{onClick:()=>this.onRemoveFilter(o.id)},r(b,null))),r("div",null,this.renderExtra(e,a)))}),s.filter(o=>!o.hidden).length>0?r("div",{class:"add-filter-divider"}):"")}autoCorrect(t){var i,e;if(!t)return;const s=t.closest("revo-grid");if(!s)return;const n=t.getBoundingClientRect(),a=s.getBoundingClientRect().right-n.width;n.left>a&&t.offsetLeft&&(t.style.left=`${a-((e=(i=t.parentElement)===null||i===void 0?void 0:i.getBoundingClientRect().left)!==null&&e!==void 0?e:0)}px`)}onFilterTypeChange(t,i,e){t.target instanceof HTMLSelectElement&&(this.filterItems[i][e].type=t.target.value,this.filterId++,setTimeout(()=>{const s=document.getElementById("filter-input-"+this.filterItems[i][e].id);s instanceof HTMLInputElement&&s.focus()},0),this.disableDynamicFiltering||this.debouncedApplyFilter())}onAddNewFilter(t){const i=t.target;this.currentFilterType=i.value,this.addNewFilterToProp();const e=document.getElementById("add-filter");e&&(e.value=d,this.currentFilterType=d),this.disableDynamicFiltering||this.debouncedApplyFilter()}addNewFilterToProp(){var t;const i=(t=this.changes)===null||t===void 0?void 0:t.prop;(i||i===0)&&(this.filterItems[i]||(this.filterItems[i]=[]),this.currentFilterType!=="none"&&(this.filterId++,this.currentFilterId=this.filterId,this.filterItems[i].push({id:this.currentFilterId,type:this.currentFilterType,value:"",relation:"and"}),setTimeout(()=>{const e=document.getElementById("filter-input-"+this.currentFilterId);e&&e.focus()},0)))}onSave(){this.filterChange.emit(this.filterItems)}onCancel(){this.changes=void 0}onReset(){var t;this.assertChanges(),this.resetChange.emit((t=this.changes)===null||t===void 0?void 0:t.prop),this.filterId++}onRemoveFilter(t){var i;this.assertChanges(),this.filterId++;const e=(i=this.changes)===null||i===void 0?void 0:i.prop,s=this.filterItems[e??""];if(!s)return;const n=s.findIndex(o=>o.id===t);n!==-1&&(s.splice(n,1),s.length===0&&delete this.filterItems[e??""],this.disableDynamicFiltering||this.debouncedApplyFilter())}toggleFilterAndOr(t){var i;this.assertChanges(),this.filterId++;const e=(i=this.changes)===null||i===void 0?void 0:i.prop,s=this.filterItems[e??""];if(!s)return;const n=s.findIndex(o=>o.id===t);n!==-1&&(s[n].relation=s[n].relation==="and"?"or":"and",this.disableDynamicFiltering||this.debouncedApplyFilter())}assertChanges(){if(!this.changes)throw new Error("Changes required per edit")}renderSelectOptions(t,i=!1){if(!this.changes)return;const e=[],s=this.changes.prop,n=new Set;if(Object.entries(this.filterItems).forEach(([o,a])=>{a.forEach(l=>{l.hidden&&n.add(l.type)})}),!i){const o=Object.assign(this.filterCaptionsInternal,this.filterCaptions);e.push(r("option",{selected:this.currentFilterType===d,value:d},s&&this.filterItems[s]&&this.filterItems[s].length>0?o.add:this.filterNames[d]))}for(let o in this.changes.filterTypes){const a=this.changes.filterTypes[o].filter(l=>!n.has(l));a.length&&(e.push(...a.map(l=>r("option",{value:l,selected:t===l},this.filterNames[l]))),e.push(r("option",{disabled:!0})))}return e}renderExtra(t,i){const e=this.filterItems[t];if(!e)return"";const s=l=>{this.filterItems[t][i].value=l,this.disableDynamicFiltering||this.debouncedApplyFilter()},n=()=>{const l=document.getElementById("add-filter");l&&(l.value=d,this.currentFilterType=d,this.addNewFilterToProp(),l.focus())},o=Object.assign(this.filterCaptionsInternal,this.filterCaptions),a=this.filterEntities[e[i].type].extra;return typeof a=="function"?a(r,{value:e[i].value,filter:e[i],prop:t,index:i,placeholder:o.placeholder,onInput:l=>{s(l)},onFocus:()=>{n()}}):a!=="input"&&a!=="datepicker"?"":r("input",{id:`filter-input-${e[i].id}`,placeholder:o.placeholder,type:a==="datepicker"?"date":"text",value:e[i].value,onInput:l=>{l.target instanceof HTMLInputElement&&s(l.target.value)},onKeyDown:l=>{if(l.key.toLowerCase()==="enter"){document.getElementById("add-filter")&&n();return}l.stopPropagation()}})}render(){var t,i,e;if(!this.changes)return r(p,{style:{display:"none"}});const s={display:"block",left:`${this.changes.x}px`,top:`${this.changes.y}px`},n=Object.assign(this.filterCaptionsInternal,this.filterCaptions);return r(p,{style:s,ref:o=>{var a;((a=this.changes)===null||a===void 0?void 0:a.autoCorrect)!==!1&&this.autoCorrect(o)}},r("slot",{slot:"header"}),((i=(t=this.changes).extraContent)===null||i===void 0?void 0:i.call(t,this.changes))||"",((e=this.changes)===null||e===void 0?void 0:e.hideDefaultFilters)!==!0&&[r("label",null,n.title),r("div",{class:"filter-holder"},this.getFilterItemsList()),r("div",{class:"add-filter"},r("select",{id:f,class:"select-css",onChange:o=>this.onAddNewFilter(o)},this.renderSelectOptions(this.currentFilterType)))],r("slot",null),r("div",{class:"filter-actions"},this.disableDynamicFiltering&&[r("button",{id:"revo-button-save","aria-label":"save",class:"revo-button green",onClick:()=>this.onSave()},n.save),r("button",{id:"revo-button-ok","aria-label":"ok",class:"revo-button green",onClick:()=>this.onCancel()},n.cancel)],!this.disableDynamicFiltering&&[r("button",{id:"revo-button-ok","aria-label":"ok",class:"revo-button green",onClick:()=>this.onCancel()},n.ok),r("button",{id:"revo-button-reset","aria-label":"reset",class:"revo-button outline",onClick:()=>this.onReset()},n.reset)]),r("slot",{slot:"footer"}))}get element(){return y(this)}};C.style=x;export{C as revogr_filter_panel};
